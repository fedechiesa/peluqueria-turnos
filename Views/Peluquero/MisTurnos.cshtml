@model List<TurnosPeluqueria.Models.Turno>

@{
    ViewData["Title"] = "Mis Turnos";
    var nombre = Context.Session.GetString("PeluqueroNombre");
}

<div class="container mt-4">
    <div class="text-center mb-4">
        <h2>üíà ¬°Hola, @nombre!</h2>
        <p class="lead">Estos son tus turnos agendados:</p>
    </div>

    @if (TempData["Exito"] != null)
    {
        <div class="alert alert-success text-center">
            @TempData["Exito"]
        </div>
    }

    <div class="text-center mb-4">
        <a asp-action="GenerarTurnos" class="btn btn-primary">Generar Turnos</a>
    </div>

    @if (!Model.Any())
    {
        <div class="alert alert-info text-center">
            üí§ No ten√©s turnos asignados por el momento.
        </div>
    }
    else
    {
        <!-- Filtro por estado -->
        <div class="mb-3">
            <label for="filtroEstado" class="form-label">Filtrar por estado:</label>
            <select class="form-select w-auto" id="filtroEstado" onchange="filtrarTurnosPorEstado()">
                <option value="todos">Todos</option>
                <option value="Pendiente">Pendiente</option>
                <option value="Confirmado">Confirmado</option>
                <option value="Cancelado">Cancelado</option>
            </select>
        </div>

        <table class="table table-hover shadow-sm border rounded" id="tablaTurnos">
            <thead class="table-dark">
                <tr>
                    <th>üßë‚Äçüíº Cliente</th>
                    <th>üíá Servicio</th>
                    <th>üìÖ Fecha</th>
                    <th>üïí Hora</th>
                    <th>üìå Estado</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var turno in Model)
                {
                    var rowClass = turno.Estado == EstadoTurno.Cancelado
                    ? "table-danger"
                    : (turno.FechaHora < DateTime.Now ? "table-secondary" : "");

                    <tr class="@rowClass">
                        <td>
                            @if (turno.Cliente != null)
                            {
                                @($"{turno.Cliente.Nombre} {turno.Cliente.Apellido}")
                            }
                            else
                            {
                                <span class="text-muted">Sin asignar</span>
                            }
                        </td>
                        <td>@turno.Servicio.Nombre</td>
                        <td>@turno.FechaHora.ToString("dd/MM/yyyy")</td>
                        <td>@turno.FechaHora.ToString("HH:mm")</td>
                        <td class="estado">@turno.Estado</td>
                    </tr>
                }
            </tbody>
        </table>
    }

    <div class="text-center mt-4">
        <a href="/Auth/Logout" class="btn btn-outline-danger">Cerrar sesi√≥n</a>
    </div>
</div>

<script>
    function filtrarTurnosPorEstado() {
        var estadoSeleccionado = document.getElementById("filtroEstado").value;
        var filas = document.querySelectorAll("#tablaTurnos tbody tr");

        filas.forEach(function (fila) {
            var estado = fila.querySelector(".estado").textContent.trim();
            if (estadoSeleccionado === "todos" || estado === estadoSeleccionado) {
                fila.style.display = "";
            } else {
                fila.style.display = "none";
            }
        });
    }
</script>